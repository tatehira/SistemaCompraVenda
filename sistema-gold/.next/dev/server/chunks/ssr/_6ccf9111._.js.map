{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Nick/Documents/Nick/Sistemas/SistemaCompraVenda/sistema-gold/src/lib/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\r\nimport path from 'path';\r\n\r\nconst dbPath = path.resolve(process.cwd(), 'gold_system.db');\r\n\r\nconst db = new Database(dbPath, { verbose: console.log });\r\ndb.pragma('journal_mode = WAL');\r\n\r\nexport default db;\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;AAE3C,MAAM,KAAK,IAAI,8LAAQ,CAAC,QAAQ;IAAE,SAAS,QAAQ,GAAG;AAAC;AACvD,GAAG,MAAM,CAAC;uCAEK"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Nick/Documents/Nick/Sistemas/SistemaCompraVenda/sistema-gold/src/actions/auth.ts"],"sourcesContent":["'use server'\r\n\r\nimport { cookies } from 'next/headers'\r\nimport { redirect } from 'next/navigation'\r\nimport { SignJWT, jwtVerify } from 'jose'\r\nimport database from '@/lib/db'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nconst SECRET_KEY = new TextEncoder().encode('my-secret-key-change-this-in-prod')\r\n\r\nexport async function login(formData: FormData) {\r\n    const username = formData.get('username') as string\r\n    const password = formData.get('password') as string // In prod, hash check!\r\n\r\n    if (!username || !password) {\r\n        return { error: 'Preencha todos os campos.' }\r\n    }\r\n\r\n    const user = database.prepare('SELECT * FROM users WHERE username = ? AND password = ?').get(username, password) as any\r\n\r\n    if (!user) {\r\n        return { error: 'Credenciais inválidas.' }\r\n    }\r\n\r\n    // Create Session\r\n    const token = await new SignJWT({ sub: user.id.toString(), role: user.role, username: user.username })\r\n        .setProtectedHeader({ alg: 'HS256' })\r\n        .setExpirationTime('24h')\r\n        .sign(SECRET_KEY)\r\n\r\n    const cookieStore = await cookies()\r\n    cookieStore.set('session', token, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === 'production',\r\n        maxAge: 60 * 60 * 24, // 1 day\r\n        path: '/',\r\n    })\r\n\r\n    redirect('/dashboard')\r\n}\r\n\r\nexport async function register(formData: FormData) {\r\n    const username = formData.get('username') as string\r\n    const password = formData.get('password') as string\r\n\r\n    if (!username || !password) {\r\n        return { error: 'Preencha todos os campos.' }\r\n    }\r\n\r\n    try {\r\n        const existing = database.prepare('SELECT * FROM users WHERE username = ?').get(username)\r\n        if (existing) {\r\n            return { error: 'Usuário já existe.' }\r\n        }\r\n\r\n        const result = database.prepare(\r\n            \"INSERT INTO users (username, password, role, preferred_unit) VALUES (?, ?, 'admin', 'g')\"\r\n        ).run(username, password)\r\n\r\n        // Auto login\r\n        const token = await new SignJWT({ sub: result.lastInsertRowid.toString(), role: 'admin', username })\r\n            .setProtectedHeader({ alg: 'HS256' })\r\n            .setExpirationTime('24h')\r\n            .sign(SECRET_KEY)\r\n\r\n        const cookieStore = await cookies()\r\n        cookieStore.set('session', token, {\r\n            httpOnly: true,\r\n            secure: process.env.NODE_ENV === 'production',\r\n            maxAge: 60 * 60 * 24, // 1 day\r\n            path: '/',\r\n        })\r\n\r\n    } catch (err: any) {\r\n        return { error: err.message || 'Erro ao criar conta.' }\r\n    }\r\n\r\n    redirect('/dashboard')\r\n}\r\n\r\nexport async function logout() {\r\n    const cookieStore = await cookies()\r\n    cookieStore.delete('session')\r\n    redirect('/login')\r\n}\r\n\r\nexport async function getSession() {\r\n    const cookieStore = await cookies()\r\n    const session = cookieStore.get('session')?.value\r\n    if (!session) return null\r\n\r\n    try {\r\n        const { payload } = await jwtVerify(session, SECRET_KEY, { algorithms: ['HS256'] })\r\n        return payload\r\n    } catch (error) {\r\n        return null\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;;;;;;;AAGA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC;AAErC,eAAe,MAAM,QAAkB;IAC1C,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,WAAW,SAAS,GAAG,CAAC,WAAsB,uBAAuB;;IAE3E,IAAI,CAAC,YAAY,CAAC,UAAU;QACxB,OAAO;YAAE,OAAO;QAA4B;IAChD;IAEA,MAAM,OAAO,2HAAQ,CAAC,OAAO,CAAC,2DAA2D,GAAG,CAAC,UAAU;IAEvG,IAAI,CAAC,MAAM;QACP,OAAO;YAAE,OAAO;QAAyB;IAC7C;IAEA,iBAAiB;IACjB,MAAM,QAAQ,MAAM,IAAI,gKAAO,CAAC;QAAE,KAAK,KAAK,EAAE,CAAC,QAAQ;QAAI,MAAM,KAAK,IAAI;QAAE,UAAU,KAAK,QAAQ;IAAC,GAC/F,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,iBAAiB,CAAC,OAClB,IAAI,CAAC;IAEV,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,WAAW,OAAO;QAC9B,UAAU;QACV,QAAQ,oDAAyB;QACjC,QAAQ,KAAK,KAAK;QAClB,MAAM;IACV;IAEA,IAAA,iMAAQ,EAAC;AACb;AAEO,eAAe,SAAS,QAAkB;IAC7C,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,WAAW,SAAS,GAAG,CAAC;IAE9B,IAAI,CAAC,YAAY,CAAC,UAAU;QACxB,OAAO;YAAE,OAAO;QAA4B;IAChD;IAEA,IAAI;QACA,MAAM,WAAW,2HAAQ,CAAC,OAAO,CAAC,0CAA0C,GAAG,CAAC;QAChF,IAAI,UAAU;YACV,OAAO;gBAAE,OAAO;YAAqB;QACzC;QAEA,MAAM,SAAS,2HAAQ,CAAC,OAAO,CAC3B,4FACF,GAAG,CAAC,UAAU;QAEhB,aAAa;QACb,MAAM,QAAQ,MAAM,IAAI,gKAAO,CAAC;YAAE,KAAK,OAAO,eAAe,CAAC,QAAQ;YAAI,MAAM;YAAS;QAAS,GAC7F,kBAAkB,CAAC;YAAE,KAAK;QAAQ,GAClC,iBAAiB,CAAC,OAClB,IAAI,CAAC;QAEV,MAAM,cAAc,MAAM,IAAA,0IAAO;QACjC,YAAY,GAAG,CAAC,WAAW,OAAO;YAC9B,UAAU;YACV,QAAQ,oDAAyB;YACjC,QAAQ,KAAK,KAAK;YAClB,MAAM;QACV;IAEJ,EAAE,OAAO,KAAU;QACf,OAAO;YAAE,OAAO,IAAI,OAAO,IAAI;QAAuB;IAC1D;IAEA,IAAA,iMAAQ,EAAC;AACb;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;IACnB,IAAA,iMAAQ,EAAC;AACb;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,UAAU,YAAY,GAAG,CAAC,YAAY;IAC5C,IAAI,CAAC,SAAS,OAAO;IAErB,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,SAAS,YAAY;YAAE,YAAY;gBAAC;aAAQ;QAAC;QACjF,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ;;;IAvFsB;IA+BA;IAuCA;IAMA;;AA5EA,+OAAA;AA+BA,+OAAA;AAuCA,+OAAA;AAMA,+OAAA"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Nick/Documents/Nick/Sistemas/SistemaCompraVenda/sistema-gold/.next-internal/server/app/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {login as '40e3529cc11f2a04b1381f754a6a7c944ce0f2ce39'} from 'ACTIONS_MODULE0'\nexport {register as '40e0bd842711d0001166ef627af8cdd4fdfd29a8c8'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}