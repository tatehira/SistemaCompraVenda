module.exports=[24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},32705,a=>{"use strict";var b=a.i(37936),c=a.i(61469),d=a.i(18558),e=a.i(24868),f=a.i(14747),g=a.i(63707);async function h(a){if(!a||0===a.size)return null;let b=await a.arrayBuffer(),c=Buffer.from(b),d=f.default.join(process.cwd(),"public","uploads");await (0,e.mkdir)(d,{recursive:!0});let g=`${Date.now()}-${a.name.replace(/\s/g,"_")}`,h=f.default.join(d,g);return await (0,e.writeFile)(h,c),`/uploads/${g}`}async function i(a){let b=await (0,g.getSession)();if(!b)return{error:"Não autorizado"};let e=Number(b.sub),f=parseFloat(a.get("weight")),i=parseFloat(a.get("price")),j=Number(a.get("gold_type_id")),k=Number(a.get("point_id")),l=a.get("customer"),m=a.get("receipt"),n=a.get("unit")||"g";if(!f||!i||!j||!k)return{error:"Preencha os campos obrigatórios."};"kg"===n&&(f*=1e3);try{let a=await h(m),b=new Date().toISOString();return c.default.prepare(`
        INSERT INTO transactions (type, weight_grams, price, customer_name, receipt_path, date, gold_type_id, point_id, user_id, unit) 
        VALUES ('BUY', ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(f,i,l,a,b,j,k,e,n),(0,d.revalidatePath)("/dashboard/inventory"),(0,d.revalidatePath)("/dashboard/transactions"),{success:!0}}catch(a){return{error:a.message}}}async function j(a){let b=await (0,g.getSession)();if(!b)return{error:"Não autorizado"};let e=Number(b.sub),f=parseFloat(a.get("weight")),i=parseFloat(a.get("price")),j=Number(a.get("gold_type_id")),k=Number(a.get("point_id")),l=a.get("customer"),m=a.get("unit")||"g",n=a.get("delivery_courier"),o=parseFloat(a.get("delivery_cost"))||0,p=a.get("receipt");if(!f||!i||!j||!k)return{error:"Preencha os campos obrigatórios."};"kg"===m&&(f*=1e3);try{let a=await h(p),b=new Date().toISOString();return c.default.prepare(`
        INSERT INTO transactions (type, weight_grams, price, customer_name, receipt_path, date, gold_type_id, point_id, user_id, unit, delivery_courier, delivery_cost) 
        VALUES ('SELL', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(f,i,l,a,b,j,k,e,m,n,o),(0,d.revalidatePath)("/dashboard/inventory"),(0,d.revalidatePath)("/dashboard/transactions"),{success:!0}}catch(a){return{error:a.message}}}async function k(){let a=await (0,g.getSession)();if(!a)return[];let b=Number(a.sub),d=c.default.prepare(`
        SELECT t.type, t.weight_grams, gt.name as gold_name, p.name as point_name 
        FROM transactions t
        LEFT JOIN gold_types gt ON t.gold_type_id = gt.id
        LEFT JOIN points p ON t.point_id = p.id
        WHERE t.user_id = ?
    `).all(b),e={};return d.forEach(a=>{let b=a.point_name||"Geral",c=a.gold_name||"Desconhecido",d=`${b}-${c}`;e[d]||(e[d]={point:b,gold:c,stock_grams:0}),"BUY"===a.type&&(e[d].stock_grams+=a.weight_grams),"SELL"===a.type&&(e[d].stock_grams-=a.weight_grams)}),Object.values(e).filter(a=>Math.abs(a.stock_grams)>.001)}async function l(){let a=await (0,g.getSession)();if(!a)return[];let b=Number(a.sub);return c.default.prepare(`
        SELECT t.*, gt.name as gold_name, p.name as point_name
        FROM transactions t
        LEFT JOIN gold_types gt ON t.gold_type_id = gt.id
        LEFT JOIN points p ON t.point_id = p.id
        WHERE t.user_id = ?
        ORDER BY date DESC
    `).all(b)}(0,a.i(13095).ensureServerEntryExports)([i,j,k,l]),(0,b.registerServerReference)(i,"4011e4ad4af21d24326eb2052b8e6074085bed4aed",null),(0,b.registerServerReference)(j,"404c8c67f791b7cd5144b3a290165d08875034dfd4",null),(0,b.registerServerReference)(k,"00ab95d72063df75aa50e57cde3609728199fe6e11",null),(0,b.registerServerReference)(l,"00fab7af394b8cefcf5dc4a8d853b75d19563c842f",null),a.s(["buy",()=>i,"getInventory",()=>k,"getTransactions",()=>l,"sell",()=>j])},35330,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-lg border border-border bg-card text-card-foreground shadow-sm",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-2xl font-semibold leading-none tracking-tight",a),...c}));g.displayName="CardTitle",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-sm text-muted-foreground",a),...c})).displayName="CardDescription";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("p-6 pt-0",a),...c}));h.displayName="CardContent",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex items-center p-6 pt-0",a),...c})).displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>h,"CardHeader",()=>f,"CardTitle",()=>g])},13522,4058,a=>{"use strict";var b=a.i(37936),c=a.i(61469),d=a.i(18558),e=a.i(13095);async function f(){return c.default.prepare("SELECT * FROM gold_types").all()}async function g(a,b){if(!a)return{error:"Nome é obrigatório."};try{return c.default.prepare("INSERT INTO gold_types (name, user_id) VALUES (?, ?)").run(a,b),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}async function h(a){try{return c.default.prepare("DELETE FROM gold_types WHERE id = ?").run(a),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}async function i(){return[{id:"g",symbol:"g",name:"Grama"},{id:"kg",symbol:"kg",name:"Quilo"}]}async function j(a,b,c){return{success:!0}}async function k(){return c.default.prepare("SELECT * FROM points").all()}async function l(a,b,e){if(!a)return{error:"Nome é obrigatório."};try{return c.default.prepare("INSERT INTO points (name, address, user_id) VALUES (?, ?, ?)").run(a,b,e),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}async function m(a){try{return c.default.prepare("DELETE FROM points WHERE id = ?").run(a),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}(0,e.ensureServerEntryExports)([f,g,h,i,j]),(0,b.registerServerReference)(f,"006ff5a9a01318355c0cb838e76207eefb49499a37",null),(0,b.registerServerReference)(g,"6042b82a4e7b8e78a90da6c68c24ede9d08b4dd8de",null),(0,b.registerServerReference)(h,"4035a79cd9c5050b1cf48c9e4e8c448e5d4ee91899",null),(0,b.registerServerReference)(i,"00c2c28db7956f12b6a324d5393faade5d24aef9c3",null),(0,b.registerServerReference)(j,"70e240c64f1b893e4330a824ff714aca8811d09d80",null),a.s(["addGoldType",()=>g,"addUnit",()=>j,"deleteGoldType",()=>h,"getGoldTypes",()=>f,"getUnits",()=>i],13522),(0,e.ensureServerEntryExports)([k,l,m]),(0,b.registerServerReference)(k,"007d81bb561d558582fb95472ef184666a2f135d30",null),(0,b.registerServerReference)(l,"70b58ca422a251fd325244d69075be06a0dd6cc405",null),(0,b.registerServerReference)(m,"400c7b16902ee3aec2a157feb04e2e7525e3bed98a",null),a.s(["addPoint",()=>l,"deletePoint",()=>m,"getPoints",()=>k],4058)},55583,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},84534,a=>{"use strict";a.s(["Label",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/ui/label.tsx <module evaluation>","Label")},7604,a=>{"use strict";a.s(["Label",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/ui/label.tsx","Label")},43562,a=>{"use strict";a.i(84534);var b=a.i(7604);a.n(b)},89285,a=>{"use strict";var b=a.i(7997),c=a.i(37936),d=a.i(13522),e=a.i(4058),f=a.i(32705),g=a.i(38904),h=a.i(55583),i=a.i(43562),j=a.i(35330);a.i(70396);var k=a.i(73727);let l=async function(a){let b=await (0,f.buy)(a);b?.error?console.error(b.error):(0,k.redirect)("/dashboard/inventory")};async function m(){let a=await (0,d.getGoldTypes)(),c=await (0,e.getPoints)();return(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsxs)(j.Card,{className:"w-full max-w-lg border-amber-200 dark:border-amber-900 shadow-amber-500/10 shadow-lg",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{className:"text-amber-600 dark:text-amber-500",children:"Nova Compra"})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("form",{action:l,className:"grid gap-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Local (Ponto)"}),(0,b.jsx)("select",{name:"point_id",className:"flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm dark:bg-zinc-950 dark:border-zinc-800 focus:ring-amber-500",required:!0,children:c.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Tipo de Ouro"}),(0,b.jsx)("select",{name:"gold_type_id",className:"flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm dark:bg-zinc-950 dark:border-zinc-800 focus:ring-amber-500",required:!0,children:a.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Peso"}),(0,b.jsx)(h.Input,{name:"weight",type:"number",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Unidade"}),(0,b.jsxs)("select",{name:"unit",className:"flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm dark:bg-zinc-950 dark:border-zinc-800 focus:ring-amber-500",children:[(0,b.jsx)("option",{value:"g",children:"Grama (g)"}),(0,b.jsx)("option",{value:"kg",children:"Quilo (kg)"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Preço Total (R$)"}),(0,b.jsx)(h.Input,{name:"price",type:"number",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Fornecedor / Cliente"}),(0,b.jsx)(h.Input,{name:"customer",placeholder:"Nome do vendedor"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Comprovante (Foto)"}),(0,b.jsx)(h.Input,{name:"receipt",type:"file",accept:"image/*"})]}),(0,b.jsx)(g.Button,{type:"submit",className:"w-full bg-amber-600 hover:bg-amber-700 text-white",children:"Registrar Compra"})]})})]})})}(0,c.registerServerReference)(l,"40cba321549654612afe1a950497edf1f8b7e5ad4d",null),a.s(["$$RSC_SERVER_ACTION_0",0,l,"default",()=>m])},41896,a=>{"use strict";var b=a.i(63707),c=a.i(89285),d=a.i(13522),e=a.i(4058),f=a.i(32705);a.s([],76246),a.i(76246),a.s(["006ff5a9a01318355c0cb838e76207eefb49499a37",()=>d.getGoldTypes,"007d81bb561d558582fb95472ef184666a2f135d30",()=>e.getPoints,"00a5fb6db855bcb8de8eb3a3a932b31c246b050806",()=>b.getSession,"00ab95d72063df75aa50e57cde3609728199fe6e11",()=>f.getInventory,"00bf6aff51c053136cb6843a038c949bec8344cd38",()=>b.logout,"00c2c28db7956f12b6a324d5393faade5d24aef9c3",()=>d.getUnits,"00fab7af394b8cefcf5dc4a8d853b75d19563c842f",()=>f.getTransactions,"400c7b16902ee3aec2a157feb04e2e7525e3bed98a",()=>e.deletePoint,"4011e4ad4af21d24326eb2052b8e6074085bed4aed",()=>f.buy,"4035a79cd9c5050b1cf48c9e4e8c448e5d4ee91899",()=>d.deleteGoldType,"404c8c67f791b7cd5144b3a290165d08875034dfd4",()=>f.sell,"40cba321549654612afe1a950497edf1f8b7e5ad4d",()=>c.$$RSC_SERVER_ACTION_0,"40de66b91b194dec19db6ac662585f11b7e4a40d7e",()=>b.register,"40fde23bb9f3b5528f0905b64385d2e2c58f4d95ea",()=>b.login,"6042b82a4e7b8e78a90da6c68c24ede9d08b4dd8de",()=>d.addGoldType,"70b58ca422a251fd325244d69075be06a0dd6cc405",()=>e.addPoint,"70e240c64f1b893e4330a824ff714aca8811d09d80",()=>d.addUnit],41896)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__db01f740._.js.map