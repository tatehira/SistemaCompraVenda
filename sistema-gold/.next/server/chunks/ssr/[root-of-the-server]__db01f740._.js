module.exports=[24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},32705,a=>{"use strict";var b=a.i(37936),c=a.i(61469),d=a.i(18558),e=a.i(24868),f=a.i(14747),g=a.i(63707);async function h(a){if(!a||0===a.size)return null;let b=await a.arrayBuffer(),c=Buffer.from(b),d=f.default.join(process.cwd(),"public","uploads");await (0,e.mkdir)(d,{recursive:!0});let g=`${Date.now()}-${a.name.replace(/\s/g,"_")}`,h=f.default.join(d,g);return await (0,e.writeFile)(h,c),`/uploads/${g}`}async function i(a){let b=await (0,g.getSession)();if(!b)return{error:"Não autorizado"};let e=Number(b.sub),f=parseFloat(a.get("weight")),i=parseFloat(a.get("price")),j=Number(a.get("gold_type_id")),k=Number(a.get("point_id")),l=a.get("customer"),m=a.get("receipt"),n=a.get("unit")||"g";if(!f||!i||!j||!k)return{error:"Preencha os campos obrigatórios."};"kg"===n&&(f*=1e3);try{let a=await h(m),b=new Date().toISOString();return c.default.prepare(`
        INSERT INTO transactions (type, weight_grams, price, customer_name, receipt_path, date, gold_type_id, point_id, user_id, unit) 
        VALUES ('BUY', ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(f,i,l,a,b,j,k,e,n),(0,d.revalidatePath)("/dashboard/inventory"),(0,d.revalidatePath)("/dashboard/transactions"),{success:!0}}catch(a){return{error:a.message}}}async function j(a){let b=await (0,g.getSession)();if(!b)return{error:"Não autorizado"};let e=Number(b.sub),f=parseFloat(a.get("weight")),i=parseFloat(a.get("price")),j=Number(a.get("gold_type_id")),k=Number(a.get("point_id")),l=a.get("customer"),m=a.get("unit")||"g",n=a.get("delivery_courier"),o=parseFloat(a.get("delivery_cost"))||0,p=a.get("receipt");if(!f||!i||!j||!k)return{error:"Preencha os campos obrigatórios."};"kg"===m&&(f*=1e3);try{let a=await h(p),b=new Date().toISOString();return c.default.prepare(`
        INSERT INTO transactions (type, weight_grams, price, customer_name, receipt_path, date, gold_type_id, point_id, user_id, unit, delivery_courier, delivery_cost) 
        VALUES ('SELL', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(f,i,l,a,b,j,k,e,m,n,o),(0,d.revalidatePath)("/dashboard/inventory"),(0,d.revalidatePath)("/dashboard/transactions"),{success:!0}}catch(a){return{error:a.message}}}async function k(){let a=await (0,g.getSession)();if(!a)return[];let b=Number(a.sub),d=c.default.prepare(`
        SELECT t.type, t.weight_grams, gt.name as gold_name, p.name as point_name 
        FROM transactions t
        LEFT JOIN gold_types gt ON t.gold_type_id = gt.id
        LEFT JOIN points p ON t.point_id = p.id
        WHERE t.user_id = ?
    `).all(b),e={};return d.forEach(a=>{let b=a.point_name||"Geral",c=a.gold_name||"Desconhecido",d=`${b}-${c}`;e[d]||(e[d]={point:b,gold:c,stock_grams:0}),"BUY"===a.type&&(e[d].stock_grams+=a.weight_grams),"SELL"===a.type&&(e[d].stock_grams-=a.weight_grams)}),Object.values(e).filter(a=>Math.abs(a.stock_grams)>.001)}async function l(){let a=await (0,g.getSession)();if(!a)return[];let b=Number(a.sub);return c.default.prepare(`
        SELECT t.*, gt.name as gold_name, p.name as point_name
        FROM transactions t
        LEFT JOIN gold_types gt ON t.gold_type_id = gt.id
        LEFT JOIN points p ON t.point_id = p.id
        WHERE t.user_id = ?
        ORDER BY date DESC
    `).all(b)}(0,a.i(13095).ensureServerEntryExports)([i,j,k,l]),(0,b.registerServerReference)(i,"40a6bd7a98cbdb2610d87168772495a140cc23b2bb",null),(0,b.registerServerReference)(j,"40f2e801184a8ed1f430e97bac6910394b6cc2bfc2",null),(0,b.registerServerReference)(k,"003324c74d0aa8c732b6ab05246d9f2eb2e7db5f56",null),(0,b.registerServerReference)(l,"00b1aa0a5aabcd51d7e4770e006ea38d2077a06119",null),a.s(["buy",()=>i,"getInventory",()=>k,"getTransactions",()=>l,"sell",()=>j])},35330,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-lg border border-border bg-card text-card-foreground shadow-sm",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-2xl font-semibold leading-none tracking-tight",a),...c}));g.displayName="CardTitle",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-sm text-muted-foreground",a),...c})).displayName="CardDescription";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("p-6 pt-0",a),...c}));h.displayName="CardContent",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex items-center p-6 pt-0",a),...c})).displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>h,"CardHeader",()=>f,"CardTitle",()=>g])},13522,4058,a=>{"use strict";var b=a.i(37936),c=a.i(61469),d=a.i(18558),e=a.i(13095);async function f(){return c.default.prepare("SELECT * FROM gold_types").all()}async function g(a,b){if(!a)return{error:"Nome é obrigatório."};try{return c.default.prepare("INSERT INTO gold_types (name, user_id) VALUES (?, ?)").run(a,b),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}async function h(a){try{return c.default.prepare("DELETE FROM gold_types WHERE id = ?").run(a),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}async function i(){return[{id:"g",symbol:"g",name:"Grama"},{id:"kg",symbol:"kg",name:"Quilo"}]}async function j(a,b,c){return{success:!0}}async function k(){return c.default.prepare("SELECT * FROM points").all()}async function l(a,b,e){if(!a)return{error:"Nome é obrigatório."};try{return c.default.prepare("INSERT INTO points (name, address, user_id) VALUES (?, ?, ?)").run(a,b,e),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}async function m(a){try{return c.default.prepare("DELETE FROM points WHERE id = ?").run(a),(0,d.revalidatePath)("/dashboard/settings"),{success:!0}}catch(a){return{error:a.message}}}(0,e.ensureServerEntryExports)([f,g,h,i,j]),(0,b.registerServerReference)(f,"00f3410f6d08b8cb3701ec4238dabf8a160398bd29",null),(0,b.registerServerReference)(g,"603fc9fd145338ddfbebf930af7564cf39c3ae19c0",null),(0,b.registerServerReference)(h,"40079914d97da5899fcee401c7478d3114966a05bf",null),(0,b.registerServerReference)(i,"009d382922b071364764179b1f7a5783eee68df1ad",null),(0,b.registerServerReference)(j,"70976d5adb8cfd00ee45690b73af91aee0d7cd2c82",null),a.s(["addGoldType",()=>g,"addUnit",()=>j,"deleteGoldType",()=>h,"getGoldTypes",()=>f,"getUnits",()=>i],13522),(0,e.ensureServerEntryExports)([k,l,m]),(0,b.registerServerReference)(k,"00e044cb070627323741c2b21cf1874bb233a689c9",null),(0,b.registerServerReference)(l,"7023aa85bea6dbf7589e36d0a1dce745f3bc64eb99",null),(0,b.registerServerReference)(m,"40d5b5eb154185734c920d8afd833e43f6fb5ec707",null),a.s(["addPoint",()=>l,"deletePoint",()=>m,"getPoints",()=>k],4058)},55583,a=>{"use strict";var b=a.i(7997),c=a.i(717),d=a.i(39138);let e=c.forwardRef(({className:a,type:c,...e},f)=>(0,b.jsx)("input",{type:c,className:(0,d.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:f,...e}));e.displayName="Input",a.s(["Input",()=>e])},84534,a=>{"use strict";a.s(["Label",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/ui/label.tsx <module evaluation>","Label")},7604,a=>{"use strict";a.s(["Label",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call Label() from the server but Label is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/ui/label.tsx","Label")},43562,a=>{"use strict";a.i(84534);var b=a.i(7604);a.n(b)},89285,a=>{"use strict";var b=a.i(7997),c=a.i(37936),d=a.i(13522),e=a.i(4058),f=a.i(32705),g=a.i(38904),h=a.i(55583),i=a.i(43562),j=a.i(35330);a.i(70396);var k=a.i(73727);let l=async function(a){let b=await (0,f.buy)(a);b?.error?console.error(b.error):(0,k.redirect)("/dashboard/inventory")};async function m(){let a=await (0,d.getGoldTypes)(),c=await (0,e.getPoints)();return(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsxs)(j.Card,{className:"w-full max-w-lg border-amber-200 shadow-xl shadow-amber-500/10 rounded-xl transition-all duration-300 hover:shadow-amber-500/20 bg-white",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{className:"text-amber-600 text-2xl font-bold",children:"Nova Compra"})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("form",{action:l,className:"grid gap-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Local (Ponto)"}),(0,b.jsx)("select",{name:"point_id",className:"flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-200",required:!0,children:c.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Tipo de Ouro"}),(0,b.jsx)("select",{name:"gold_type_id",className:"flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-200",required:!0,children:a.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Peso"}),(0,b.jsx)(h.Input,{name:"weight",type:"number",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Unidade"}),(0,b.jsxs)("select",{name:"unit",className:"flex h-10 w-full rounded-md border border-zinc-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-200",children:[(0,b.jsx)("option",{value:"g",children:"Grama (g)"}),(0,b.jsx)("option",{value:"kg",children:"Quilo (kg)"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Preço Total (R$)"}),(0,b.jsx)(h.Input,{name:"price",type:"number",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Fornecedor / Cliente"}),(0,b.jsx)(h.Input,{name:"customer",placeholder:"Nome do vendedor"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{children:"Comprovante (Foto)"}),(0,b.jsx)(h.Input,{name:"receipt",type:"file",accept:"image/*"})]}),(0,b.jsx)(g.Button,{type:"submit",className:"w-full bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-6 rounded-xl shadow-lg shadow-amber-500/20 transition-all duration-300 transform hover:scale-[1.02]",children:"Registrar Compra"})]})})]})})}(0,c.registerServerReference)(l,"4045419a092b432464ba9db3314fe031cc52fcd181",null),a.s(["$$RSC_SERVER_ACTION_0",0,l,"default",()=>m])},41896,a=>{"use strict";var b=a.i(63707),c=a.i(89285),d=a.i(13522),e=a.i(4058),f=a.i(32705);a.s([],76246),a.i(76246),a.s(["001cff6da69649cb3538ebb44b85726acfda477617",()=>b.getSession,"003324c74d0aa8c732b6ab05246d9f2eb2e7db5f56",()=>f.getInventory,"009d382922b071364764179b1f7a5783eee68df1ad",()=>d.getUnits,"00b1aa0a5aabcd51d7e4770e006ea38d2077a06119",()=>f.getTransactions,"00e044cb070627323741c2b21cf1874bb233a689c9",()=>e.getPoints,"00f3410f6d08b8cb3701ec4238dabf8a160398bd29",()=>d.getGoldTypes,"00f5ae00e140bafd8c394ea98ad441ac36c1f2b778",()=>b.logout,"400005926efb722f25cb6dbbee9d650d9ce8a30e42",()=>b.register,"40079914d97da5899fcee401c7478d3114966a05bf",()=>d.deleteGoldType,"4045419a092b432464ba9db3314fe031cc52fcd181",()=>c.$$RSC_SERVER_ACTION_0,"40a6bd7a98cbdb2610d87168772495a140cc23b2bb",()=>f.buy,"40b73d41e742e5c9864de0c62d5bd2bf172ed6c6d1",()=>b.login,"40d5b5eb154185734c920d8afd833e43f6fb5ec707",()=>e.deletePoint,"40f2e801184a8ed1f430e97bac6910394b6cc2bfc2",()=>f.sell,"603fc9fd145338ddfbebf930af7564cf39c3ae19c0",()=>d.addGoldType,"7023aa85bea6dbf7589e36d0a1dce745f3bc64eb99",()=>e.addPoint,"70976d5adb8cfd00ee45690b73af91aee0d7cd2c82",()=>d.addUnit],41896)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__db01f740._.js.map